<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Assinar Documento</title>
</head>
<body>

<h2>Assinatura</h2>

<label>Nome:</label><br>
<input type="text" id="nome"><br><br>

<canvas id="canvas" width="300" height="150" style="border:1px solid"></canvas><br>
<button onclick="limpar()">Limpar</button>
<button onclick="enviar()">Enviar Assinatura</button>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let desenhando = false;

canvas.addEventListener("mousedown", () => desenhando = true);
canvas.addEventListener("mouseup", () => desenhando = false);
canvas.addEventListener("mousemove", desenhar);

canvas.addEventListener("touchstart", () => desenhando = true);
canvas.addEventListener("touchend", () => desenhando = false);
canvas.addEventListener("touchmove", desenharTouch);

function desenhar(e) {
  if (!desenhando) return;
  ctx.lineWidth = 2;
  ctx.lineTo(e.offsetX, e.offsetY);
  ctx.stroke();
}

function desenharTouch(e) {
  if (!desenhando) return;
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
  ctx.stroke();
}

function limpar() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

async function enviar() {
  const nome = document.getElementById("nome").value;
  if (!nome) {
    alert("Digite o nome");
    return;
  }

  const params = new URLSearchParams(window.location.search);
  const documentoId = params.get("doc");

  const assinatura = canvas.toDataURL();

  await fetch("http://localhost:3000/assinar", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ documentoId, nome, assinatura })
  });

  alert("Assinatura enviada!");
}
</script>

</body>
</html>
